<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>خريطة سبر</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map { height:100%; margin:0; }
    /* (اختياري) إخفاء مربعات الخطأ لو في مستويات ناقصة */
    .leaflet-tile-container img.leaflet-tile[alt=""] { opacity: 0; }
    .leaflet-control-layers-expanded { direction: ltr; } /* لضبط قائمة الطبقات */
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // 1) إنشاء الخريطة (عدّل الإحداثيات والزووم الافتراضي حسب منطقتك)
    const map = L.map('map', { zoomControl: true }).setView([21.6, 39.1], 10);

    // 2) طبقة أساس اختيارية لاختبار أن الصفحة ترسم (تقدر تطفيها من الكنترول)
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // 3) بلاطاتك المحلية من مجلد tiles/ (مهم: بدون / في البداية لأننا على GitHub Pages)
    // سنجرب tms:true أولًا، ولو فشل كثير نقلب إلى tms:false تلقائيًا.
    let customLayer;
    let useTMS = true;            // نجرب TMS أولاً
    let errorCount = 0;

    function addCustomTiles() {
      if (customLayer) {
        map.removeLayer(customLayer);
      }
      customLayer = L.tileLayer('tiles/{z}/{x}/{y}.png', {
        minZoom: 6,
        maxZoom: 16,
        tms: useTMS,
        attribution: '© سبر'
        // errorTileUrl: '' // (اختياري) لإخفاء مربعات الخطأ
      });

      // لو عدد أخطاء البلاطات تجاوز 10، بدّل وضع tms وجرّب مرة أخرى
      errorCount = 0;
      customLayer.on('tileerror', () => {
        errorCount++;
        if (errorCount === 10) {
          useTMS = !useTMS;         // بدّل TMS ↔︎ XYZ
          console.warn('Switching tms to', useTMS);
          addCustomTiles();         // أعد تحميل الطبقة بالإعداد الجديد
        }
      });

      customLayer.addTo(map);
    }

    addCustomTiles();

    // 4) كنترول الطبقات (تقدر تقفل/تشغّل OSM أو طبقتك)
    L.control.layers(
      { 'OpenStreetMap': osm },
      { 'سطح المشروع (tiles/)': customLayer },
      { collapsed: false }
    ).addTo(map);

    // (اختياري) لو تبغى تمنع خروج الخريطة عن حدود معينة:
    // map.setMaxBounds([[latSW, lonSW], [latNE, lonNE]]);
  </script>
</body>
</html>
